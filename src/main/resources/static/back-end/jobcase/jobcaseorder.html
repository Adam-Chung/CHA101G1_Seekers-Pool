<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1.0" name="viewport">

    <title>Seeker's Pool</title>
    <meta content="" name="description">
    <meta content="" name="keywords">

    <!-- Favicons -->
    <link href="../../common/img/handshake-regular.svg" rel="icon">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <!-- Google Fonts -->
    <link href="https://fonts.gstatic.com" rel="preconnect">
    <link
        href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i|Nunito:300,300i,400,400i,600,600i,700,700i|Poppins:300,300i,400,400i,500,500i,600,600i,700,700i"
        rel="stylesheet">

    <!-- Vendor CSS Files -->
    <link href="../../common/css/packageCSS/bootstrap.min.css" rel="stylesheet">
    <link href="../../common/css/packageCSS/bootstrap-icons.css" rel="stylesheet">
    <link href="../../common/css/packageCSS/boxicons.min.css" rel="stylesheet">
    <link href="../../common/css/packageCSS/quill.snow.css" rel="stylesheet">
    <link href="../../common/css/packageCSS/quill.bubble.css" rel="stylesheet">
    <link href="../../common/css/packageCSS/remixicon.css" rel="stylesheet">
    <link href="../../common/css/packageCSS/style.css" rel="stylesheet">

    <!-- Template Main CSS File -->
    <link href="../../common/css/Employee.css" rel="stylesheet">

    <!-- Font Awesome-->
    <script src="https://kit.fontawesome.com/244879c400.js" crossorigin="anonymous"></script>

    <style>
        body {
            font-family: "Open Sans", -apple-system, BlinkMacSystemFont, "Segoe UI",
                Roboto, Oxygen-Sans, Ubuntu, Cantarell, "Helvetica Neue", Helvetica,
                Arial, sans-serif;
        }

        thead>tr>th,
        tbody>tr>td {
            text-align: center;
            vertical-align: middle;
        }
    </style>
    <!-- jQuery -->
    <script src="../../common/js/jquery-3.6.4.min.js"></script>
	 <script>
 // ======== 引入header ===========
    $.get("../../common/buildPage/Employee_Header.html", function (data) {
        $("#header1").html(data);

        $.getScript("../../common/js/Employee.js", function () {
        });
    });

    // ======== 引入sidebar ===========
    $.get("../../common/buildPage/Employee_Sidebar.html", function (data) {
        $("#sidebar1").html(data);
    });
    
    </script>
</head>

<body>
    <!-- ========================== Header ================================ -->
    <div id="header1"></div>

    <!-- ========================== Sidebar =============================== -->
    <div id="sidebar1"></div>

    <!-- =========================== main ================================= -->
    <main id="main" class="main">

        <!--職缺刊登方案  刊登訂單管理-->
        <div class="pagetitle">
            <h1>刊登訂單管理</h1>
            <nav>
                <ol class="breadcrumb">
                    <li class="breadcrumb-item"><a href="Employee.html">Home</a></li>
                    <li class="breadcrumb-item active"><a href="JobCaseOrder.html">職缺刊登訂單管理</a></li>
                    <li class="breadcrumb-item active">刊登訂單管理</li>
                </ol>
            </nav>
            <hr>
        </div>
        <div class="row">
            <div class="mb-3 col-lg-3">
                <label for="inputJcNoSearch" class="form-label"><strong style="font-size:large;">刊登訂單查詢</strong></label>
                <div class="input-group">
                    <input type="text" class="form-control" id="inputJcNoSearch" placeholder="請輸入訂單編號">
                    <button type="button" class="btn btn-primary" id="btnJcNoSearch"><strong>查詢</strong></button>
                </div>
            </div>
            <div class="mb-3 col-lg-6 d-flex align-items-end">
                <button type="button" class="btn btn-primary" id="btnQuery"><strong>查詢全部</strong></button>
            </div>
        </div>
        <span class="counter pull-right"></span>
        <div class="table table-hover">
            <table class="table table-hover">
                <thead class="bill-header cs">
                    <tr>
                        <th id="JO_NO" class="JO_NO">訂單編號</th>
                        <th id="COM_NAME" class="COM_NAME">企業名稱</th>
                        <th id="JC_NO" class="JC_NO">方案編號</th>
                        <th id="JOB_PUBLISHED_NUM" class="JOB_PUBLISHED_NUM">可上架數量</th>
                        <th id="JOB_PUBLISHED_TOP_NUM" class="JOB_PUBLISHED_TOP_NUM">可置頂數量</th>
                        <th id="JC_DEADLINE" class="JC_DEADLINE">刊登天數</th>
                        <th id="JC_DEADLINE" class="JC_DEADLINE">截止日</th>
                        <th id="JC_PRICE" class="JC_PRICE">方案金額($NTD)</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- 動態生成 -->
                </tbody>
            </table>
        </div>

        <!-- 底部分頁 -->
<!--         <nav aria-label="Page navigation"> -->
<!--             <ul class="pagination justify-content-center"> -->
<!--                 <li class="page-item disabled"> -->
<!--                     <a class="page-link" href="#" tabindex="-1">Previous</a> -->
<!--                 </li> -->
<!--                 <li class="page-item"><a class="page-link" href="#">1</a></li> -->
<!--                 <li class="page-item"><a class="page-link" href="#">2</a></li> -->
<!--                 <li class="page-item"><a class="page-link" href="#">3</a></li> -->
<!--                 <li class="page-item"> -->
<!--                     <a class="page-link" href="#">Next</a> -->
<!--                 </li> -->
<!--             </ul> -->
<!--         </nav> -->

    </main>

    <!-- 首頁sidebar下拉 -->
    <script src="../../common/js/packageJS/bootstrap.bundle.min.js"></script>

    <script>
        $(function () {
         // ======== 權限設定 ===========
            $.ajax({
                url: "/SeekerPool/administrator.do",
                method: 'POST',
                datatype: "JSON",
                data: { action: "getOne_For_Display3" },
                success: function (res) {
                    $("span#name").text(res.admName);
                    $("h6#name").text(res.admName);
                    $("input#schemeNumber2").val(res.admId);
                }
            })
            $("a#out").on("click", function (e) {
                e.preventDefault;
            })
            $("span#out").on("click", function () {
                if (confirm("確定要登出?")) {

                    $.ajax({
                        url: "/SeekerPool/administrator.do",
                        method: 'POST',
                        datatype: "JSON",
                        data: { action: "logout" },
                        success: function (res) {
                            alert(res);
                            window.location.replace('../jobfair/jfback/EmployeeLogin.html');
                        }
                    })
                }
            })
            
            // ======== AJAX ===========
            $.post({
                url: "../../JobCaseQueryServlet",
                dataType: "JSON",
                data: { action: "selectByOrder" },
                async: false,
                cache: false,
                success: function (res) {
                    $("tbody").empty();
//                     console.log("sucess............");
                    for (let r of res) {
                        // 假設r.jcDeadline為「Oct 10, 2023, 12:00:00 AM」格式的日期字串
                        let originalDate = new Date(r.jcDeadline);
                        let year = originalDate.getFullYear();
                        let month = ("0" + (originalDate.getMonth() + 1)).slice(-2); // 月份需加1，並在前面補0
                        let day = ("0" + originalDate.getDate()).slice(-2); // 日需在前面補0
                        let formattedDate = year + "-" + month + "-" + day;
                        // console.log("formattedDate :" + formattedDate);
                        $("tbody").append(`
                            <tr id="all">
                                <td class="joNo" name="joNo">${r.joNo}</td>
                                <td class="comName" name="comName">${r.comName}</td>
                                <td class="jcName" name="jcName">${r.jcName}</td>
                                <td class="jcAvailableNum" name="jcAvailableNum">${r.jcAvailableNum}</td>
                                <td class="jcTop" name="jcTop">${r.jcTop}</td>
                                <td class="jcExpTime" name="jcExpTime">${r.jcExpTime}</td>
                                <td class="jcDeadline" name="jcDeadline">${formattedDate}</td>
                                <td class="jcPrice" name="jcPrice">${r.jcPrice}</td>
                            </tr> `
                        )
                    }
                }
            })

            $("#btnJcNoSearch").click(function () {
                var joNo = $("#inputJcNoSearch").val().trim();
//                 console.log(joNo);
			if (joNo !== "" && /^[0-9]+$/.test(joNo)) {
                $.ajax({
                    url: "../../JobCaseQueryServlet",
                    method: 'POST',
                    datatype: "JSON",
                    // contentType: false, // 設置為 false 或 'multipart/form-data'
                    data: {
                        action: "selectByOrderNo",
                        joNo: joNo
                    },
                    success: function (res) {
//                         console.log("res :" + res);
//                         console.log("resjoNo :" + res[0].joNo);
//                         console.log("rescomName :" + res[0].comName);
//                         console.log("resjcName :" + res[0].jcName);
//                         console.log("jcDeadline :" + res[0].jcDeadline);
//                         console.log("BBB");
                        if (res) {
                            let originalDate = new Date(res[0].jcDeadline);
                            let year = originalDate.getFullYear();
                            let month = ("0" + (originalDate.getMonth() + 1)).slice(-2); // 月份需加1，並在前面補0
                            let day = ("0" + originalDate.getDate()).slice(-2); // 日需在前面補0
                            let formattedDate = year + "-" + month + "-" + day;
                            $("tr#all").remove();
//                             console.log(res);
                            $("tbody").append(
                                `<tr id="all">
                                    <td class="joNo" name="joNo">${res[0].joNo}</td>
                                    <td class="comName" name="comName">${res[0].comName}</td>
                                    <td class="jcName" name="jcName">${res[0].jcName}</td>
                                    <td class="jcAvailableNum" name="jcAvailableNum">${res[0].jcAvailableNum}</td>
                                    <td class="jcTop" name="jcTop">${res[0].jcTop}</td>
                                    <td class="jcExpTime" name="jcExpTime">${res[0].jcExpTime}</td>
                                    <td class="jcDeadline" name="jcDeadline">${formattedDate}</td>
                                    <td class="jcPrice" name="jcPrice">${res[0].jcPrice}</td>
                                </tr>`
                            );
                            $("tr#all").prevAll().remove();
                        } else {
                            $("tr#trNO").remove();
//                             console.log(res);
                            $("tbody").append(
                                `<tr id="trNO">
									<td style='color: red; font-weight: bold;'>查無此編號!!!</td>
									<td></td>
									<td></td>
									<td></td>
									<td></td>
									<td></td>
									<td></td>
									<td></td>
								</tr>`);
                            $("tr#trNO").prevAll().remove();
                        }
                    }
                });
			} else {
//					console.log("請輸入數字");
				alert("錯誤! 訂單編號請輸入數字(ex: 1)");
			}
            })
        });

        $("button#btnQuery").click(function () {
            console.log("重新載入");
            location.reload();
        })
    </script>

</body>

</html>