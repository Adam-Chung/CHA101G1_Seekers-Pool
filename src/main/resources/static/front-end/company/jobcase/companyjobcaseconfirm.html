<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SEEKER'S POOL 招募管理</title>
    <link rel="stylesheet" href="./css/vacancyjobcase.css">
    <!-- <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-wEmeIV1mKuiNpC+IOBjI7aAzPcEZeedi5yW5f2yOq55WWLwNGmvvx4Um1vskeMj0" crossorigin="anonymous"> -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <!-- <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-p34f1UUtsS3wqzfto5wAAmdvj+osOnFyQFpp4Ua3gs/ZVWx6oOypYoCJhGGScy+8"
        crossorigin="anonymous"></script> -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
        crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
        integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />
    <!-------------------- 引入axios -------------------->
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>

    <style>
        .header-nav .nav-profile img {
            max-height: 30px;
            max-height: 36px;
        }

        nav.navbar img {
            max-width: 60px;
            max-height: 60px;
            margin-right: 15px;
        }

        div.row {
            margin: 0px 0px 8px;
        }

        div.col {
            margin: 0px;
            display: flex;
            width: 18%;
            align-items: center;
        }

        input.form-label {
            margin-bottom: 0;
        }

        tr.trLightBox>td {
            text-align: center;
        }
    </style>
    <script src="./js/jquery-3.6.4.min.js"></script>
</head>

<body>
    <main>

        <div class="container">
            <aside id="sidebar" class="sidebar">
                <div class="logo">
                    <div class="img">
                        <img src="./img/TSMC_logo.svg.png" alt="this is a logo" id="logoImg">
                    </div>
                    <h3 id="brand-name">台雞電股份有限公司</h3>
                </div>
                <menu>
                    <ul>
                        <li class="main-list center">
                            <a href="#" draggable="false"> <!--第一個-->
                                <i class="fa-solid fa-address-card"></i>會員中心
                                <div class="caret-icon">
                                    <i class="fa-solid fa-sort-down"></i>
                                </div>
                            </a>

                            <!-- ======================= sub-menu ====================== -->
                            <ul class="sub-menu collapse -none">
                                <li class="sub-list">
                                    <a href="../companymember/companyInfo.html" draggable="false">會員資料管理</a>
                                </li>

                                <li class="sub-list">
                                    <a href="../vacancy/html/VacancyManagement.html" draggable="false">職缺管理</a>
                                </li>

                                <li class="sub-list">
                                    <a href="../companymember/interviewer_manage.html" draggable="false">應徵者管理</a>
                                </li>
                            </ul>
                        </li>

                        <li class="main-list talent-search">
                            <a href="../vacancy/html/TalentSearch.html" draggable="false"> <!--第二個-->
                                <i class="fa-solid fa-user-tie"></i>人才查詢
                            </a>

                        </li>

                        <li class="main-list purchase">
                            <a href="#" draggable="false"> <!--第三個-->
                                <i class="fa-solid fa-cart-shopping"></i>刊登方案
                                <div class="caret-icon">
                                    <i class="fa-solid fa-sort-down"></i>
                                </div>
                            </a>
                            <ul class="sub-menu collapse -none">
                                <li class="sub-list">
                                    <a href="companyjobselect.html" draggable="false">刊登職缺管理</a>
                                </li>
                                <li class="sub-list">
                                    <a href="companyjobcase.html" draggable="false">刊登方案</a>
                                </li>
                                <li class="sub-list">
                                    <a href="companyjobcaseconfirm.html" draggable="false">我要刊登</a>
                                </li>
                                <li class="sub-list">
                                    <a href="companyjobordersearch.html" draggable="false">刊登訂單查詢</a>
                                </li>
                            </ul>
                        </li>
                        <li class="main-list expo">
                            <a href="#" draggable="false">
                                <!--第四個-->
                                <i class="fa-solid fa-house"></i></i>徵才博覽會管理
                                <div class="caret-icon">
                                    <i class="fa-solid fa-sort-down"></i>
                                    <i id="-none" class="fa-solid fa-caret-up"></i>
                                </div>
                            </a>
                            <ul class="sub-menu collapse -none">
                                <li class="sub-list">
                                    <a href="../../company/jobfair/jfindex/Companyjobfair.html"
                                        draggable="false">徵才博覽會一覽</a>
                                </li>
                                <li class="sub-list">
                                    <a href="../../company/jobfair/jfindex/signUpRecord/signUpRecord.html"
                                        draggable="false">報名紀錄</a>
                                </li>
                            </ul>
                        </li>
                        <li class="main-list logout">
                            <a href="javascript:location.href='/SeekerPool/CompanyLogout'" draggable="false"> <!--第五個-->
                                <i class="fa-solid fa-arrow-right-from-bracket"></i>登出
                            </a>
                        </li>
                    </ul>
                </menu>
            </aside>
        </div>
    </main>

    <main>
        <!-- ======================= main-content ====================== -->
        <div class="main-content">

            <!-- main -->
            <section id="main" class="main" style="margin-top: 30px; margin-left: 20px;">
                <div class="pagetitle">
                    <h1>我要刊登</h1>
                    <nav>
                        <ol class="breadcrumb">
                            <li class="breadcrumb-item"><a href="#">Home</a></li>
                            <li class="breadcrumb-item active"><a href="companyjobcase.html">刊登方案</a></li>
                            <li class="breadcrumb-item active">我要刊登 </li>
                        </ol>
                    </nav>
                </div>
                <hr>
                <form action="">

                    <div class="row">
                        <div class="col-lg-3 col">
                            <label for="jcExpTime" class="form-label">方案刊登天數</label>
                        </div>
                        <div class="col-lg-3">
                            <input type="text" class="form-control" id="jcExpTime" name="jcExpTime" Disabled>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-lg-3 col">
                            <label for="jcDeadline" class="form-label">截止日(今日起算)
                            </label>
                        </div>
                        <div class="col-lg-3">
                            <input type="text" class="form-control" id="jcDeadline" name="jcDeadline" Disabled>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-lg-3 col">
                            <label for="jcAvailableNum" class="form-label">職缺上架數量</label>
                        </div>
                        <div class="col-lg-3">
                            <input type="text" class="form-control" id="jcAvailableNum" name="jcAvailableNum" Disabled>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-lg-3 col">
                            <label for="jcTop" class="form-label">職缺置頂數量</label>
                        </div>
                        <div class="col-lg-3">
                            <input type="text" class="form-control" id="jcTop" name="jcTop" Disabled>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-lg-3 col1" style="align-items: top; display: flex; width: 18%;">
                            <label for="jcPrice" class="form-label" style="margin: 0px;">方案金額</label>
                        </div>
                        <div class="col-lg-3">
                            <input type="number" class="form-control" id="jcPrice" name="jcPrice" Disabled>
                            <button type="button" style="margin-top: 20px;" class="btn btn-primary" id="btnOrder"
                                data-bs-toggle="modal" data-bs-target="#orderDetail">
                                確定購買
                            </button>
                            <a href="companyjobcase.html" type="button" class="btn btn-secondary"
                                style="margin: 20px 5px 0px;">上一頁</a>
                            <!-- Modal -->
                            <div class="modal fade" id="orderDetail" tabindex="-1" aria-labelledby="orderDetailLabel"
                                aria-hidden="true">
                                <div class="modal-dialog">
                                    <div class="modal-content">
                                        <div class="modal-header">
                                            <h5 class="modal-title" id="exampleModalLabel">完成訂單，請至職缺頁面綁定</h5>
                                            <button type="button" class="btn-close" data-bs-dismiss="modal"
                                                aria-label="Close"></button>
                                        </div>
                                        <div class="modal-body">
                                            <div class="table-responsive">
                                                <div class="orderNumber">
                                                    <table class="table table-hover" style="text-align: center">
                                                        <thead class="thead-Dark">
                                                            <tr>
                                                                <th>項目</th>
                                                                <th>內容</th>
                                                            </tr>
                                                        </thead>
                                                        <tbody id="tb">

                                                        </tbody>
                                                    </table>
                                                </div>
                                            </div>
                                            <div class="modal-footer">
<!--                                                 <a href="companyjobordersearch.html" type="button" -->
<!--                                                     class="btn btn-secondary">明細查詢</a> -->
                                                <a href="companyjobselect.html" type="button"
                                                    class="btn btn-primary">立即刊登</a>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </form>
            </section>
        </div>
    </main>

    <!-- 讀取sidebar企業會員資訊 -->
    <script src="./js/readInfoHeader.js"></script>
    <script>
        // ===================================================================================

        // 左邊欄位打開闔起動畫 (ok)
        $("ul").on("click", ".main-list", function () {
            $(this).closest(".main-list").find(".sub-menu").slideToggle(400, function () {
                $(this).closest(".main-list").find(".sub-menu").toggleClass("-none")
            });
        });
        // name型態String
        function getParameter(name) {
            var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)", "i");
            var r = location.search.substr(1).match(reg);
            if (r != null) return (r[2]); return null;
        }

        $.post({
            url: "../../../JobCaseQueryServlet",
            dataType: "JSON",
            data: { action: "selectAll" },
            async: false,
            cache: false,
            success: function (res) {
                var jcExpTime = $("#jcExpTime");
                var jcDeadline = $("#jcDeadline");
                var jcAvailableNum = $("#jcAvailableNum");
                var jcTop = $("#jcTop");
                var jcPrice = $("#jcPrice");

                for (let r of res) {
                    if (r.jcNo === parseInt(getParameter("id"))) {
                        // 將 jcExpTime 轉換為整數
                        var jcExpTimeInt = parseInt(r.jcExpTime);
                        // 取得當前日期
                        var currentDate = new Date();
                        // 加上 jcExpTime 天數
                        currentDate.setDate(currentDate.getDate() + jcExpTimeInt);
                        // 取得相加後的年、月、日
                        var year = currentDate.getFullYear();
                        var month = currentDate.getMonth() + 1; // 月份從 0 開始，所以要加 1
                        var day = currentDate.getDate();
                        // 組合日期字串（例如：YYYY-MM-DD）
                        var resultDate = year + "-" + month + "-" + day;
                        jcExpTime.attr("value", r.jcExpTime);
                        $("#jcDeadline").val(resultDate);
                        //                         jcDeadline.attr("value", resultDate);
                        jcDeadline = resultDate; // resultDate 赋值给 jcDeadline
                        jcAvailableNum.attr("value", r.jcAvailableNum);
                        jcTop.attr("value", r.jcTop);
                        jcPrice.attr("value", r.jcPrice);

                        $("#btnOrder").on('click', function () {
                            $("#tb").empty();
                            $("#tb").append(`
                                <tr class="trLightBox">
                                    <td>上架數量 :</td>
                                    <td name="jcAvailableNum" id="jcAvailableNum">${r.jcAvailableNum}<span>個</span></td>
                                </tr>
                                <tr class="trLightBox">
                                    <td>置頂數量 :</td>
                                    <td name="jcTop" id="jcTop">${r.jcTop}<span>個</span></td>
                                </tr>
                                <tr class="trLightBox">
                                    <td>刊登天數 :</td>
                                    <td name="jcExpTime" id="jcExpTime">${r.jcExpTime}天(${(r.jcExpTime / 30).toFixed(1)}個月)</td>
                                </tr>
                                <tr class="trLightBox">
                                    <td>截止日 :</td>
                                    <td name="jcDeadline" id="jcDeadline">${jcDeadline}</td>
                                </tr>
                                <tr class="trLightBox">
                                    <td>付款方式 :</td>
                                    <td name="jcCard" id="jcCard">信用卡(4682********4329)
                                    </td>
                                </tr class="trLightBox">
                                <tr class="trLightBox"
                                    style="border-top:1.5px solid; border-bottom:1.5px solid;">
                                    <td>金額總計(NT$) :</td>
                                    <td name="jcPrice" id="jcPrice"><span>NT$ </span>${r.jcPrice}
                                    </td>
                                </tr>`
                            )
                            $("tr#trLightBox").prevAll().remove();
                        })
                    } else {
//                         console.log(r.jcNo + "false");
                    }
                }
            }
        })

        $("#btnOrder").on('click', function () {
            var jcDeadline = $("td#jcDeadline").text();
            var jcNo = parseInt(getParameter("id"));
//             console.log("jcNo : " + jcNo);
//             console.log(typeof jcNo);
//             console.log("jcDeadline : " + jcDeadline);
//             console.log("type : " + typeof jcDeadline);
            $.post({
                url: "../../../JobOrderInsertServlet",
                dataType: "JSON",
                data: { jcNo: jcNo, jcDeadline: jcDeadline },
                async: false,
                cache: false,
                success: function (r) {
//                     console.log("JobOrderInsertServlet r: " + r);
                }
            })
        })

    </script>
</body>

</html>