<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Seeker's Pool 職缺內容</title>

    <link rel="stylesheet" href="./css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
        integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />

    <!-- jQuery -->
    <script src="js/jquery-3.4.1.min.js"></script>
    <!-- 引入header、footer的JS -->
    <script type="text/javascript" src="js/include.js"></script>
    <!-- bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.1/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-F3w7mX95PdgyTmZZMECAngseQB83DfGTowi0iMjiWaeVhAn4FJkqJByhZMI3AhiU" crossorigin="anonymous">
    <link rel="stylesheet" href="https://sweetalert2.github.io/styles/bootstrap4-buttons.css">


    <link rel="stylesheet" href="css/job_content.css">


    <style>
        pre {
            font-weight: bolder;
            font-size: 16px;
        }

        p {
            font-weight: bolder;
        }

        .map-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 9999;
        }

        .comPicture {
            height: 100px;
            width: 250px;
        }

        .lightbox-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            /* background-color: rgba(0, 0, 0, 0.8); */
        }

        .lightbox-content {
            position: absolute;
            height: 50%;
            width: 50%;
            max-height: 600px;
            max-width: 600px;
            background-color: white;
            padding: 20px;
            text-align: center;
            transform: translate(-50%, -50%);
            /* 水平垂直居中 */
            top: 50%;
            left: 50%;
        }

        .close-button {
            position: absolute;
            top: 10px;
            right: 10px;
            cursor: pointer;
        }

        .map-iframe {
            width: 100%;
            height: 100%;
        }
    </style>
</head>

<body>
    <!--引入heaer頁面-->
    <div id="header"></div>


    <!--引入list頁面-->
    <div class="list"></div>

    <main>
        <!--引入QandTop按鈕-->
        <div id="QandTop"></div>
        <div class="main-content">
            <div class="container">
                <div id="main" class="main job-page">
                    <div class="slide job-detail">
                        <div class="apply-top">
                            <button class="button  apply-button resume">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                                    class="bi bi-briefcase" viewBox="0 0 16 16">
                                    <path
                                        d="M6.5 1A1.5 1.5 0 0 0 5 2.5V3H1.5A1.5 1.5 0 0 0 0 4.5v8A1.5 1.5 0 0 0 1.5 14h13a1.5 1.5 0 0 0 1.5-1.5v-8A1.5 1.5 0 0 0 14.5 3H11v-.5A1.5 1.5 0 0 0 9.5 1h-3zm0 1h3a.5.5 0 0 1 .5.5V3H6v-.5a.5.5 0 0 1 .5-.5zm1.886 6.914L15 7.151V12.5a.5.5 0 0 1-.5.5h-13a.5.5 0 0 1-.5-.5V7.15l6.614 1.764a1.5 1.5 0 0 0 .772 0zM1.5 4h13a.5.5 0 0 1 .5.5v1.616L8.129 7.948a.5.5 0 0 1-.258 0L1 6.116V4.5a.5.5 0 0 1 .5-.5z" />
                                </svg> 應徵職缺
                            </button>
                            <button class="button  apply-button" onclick="executeExample()"><svg
                                    xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                                    class="bi bi-heart" viewBox="0 0 16 16">
                                    <path
                                        d="m8 2.748-.717-.737C5.6.281 2.514.878 1.4 3.053c-.523 1.023-.641 2.5.314 4.385.92 1.815 2.834 3.989 6.286 6.357 3.452-2.368 5.365-4.542 6.286-6.357.955-1.886.838-3.362.314-4.385C13.486.878 10.4.28 8.717 2.01L8 2.748zM8 15C-7.333 4.868 3.279-3.04 7.824 1.143c.06.055.119.112.176.171a3.12 3.12 0 0 1 .176-.17C12.72-3.042 23.333 4.867 8 15z" />
                                </svg> 收藏職缺
                            </button>

                            <button class="button  apply-button report-button">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                                    class="bi bi-flag" viewBox="0 0 16 16">
                                    <path
                                        d="M14.778.085A.5.5 0 0 1 15 .5V8a.5.5 0 0 1-.314.464L14.5 8l.186.464-.003.001-.006.003-.023.009a12.435 12.435 0 0 1-.397.15c-.264.095-.631.223-1.047.35-.816.252-1.879.523-2.71.523-.847 0-1.548-.28-2.158-.525l-.028-.01C7.68 8.71 7.14 8.5 6.5 8.5c-.7 0-1.638.23-2.437.477A19.626 19.626 0 0 0 3 9.342V15.5a.5.5 0 0 1-1 0V.5a.5.5 0 0 1 1 0v.282c.226-.079.496-.17.79-.26C4.606.272 5.67 0 6.5 0c.84 0 1.524.277 2.121.519l.043.018C9.286.788 9.828 1 10.5 1c.7 0 1.638-.23 2.437-.477a19.587 19.587 0 0 0 1.349-.476l.019-.007.004-.002h.001M14 1.221c-.22.078-.48.167-.766.255-.81.252-1.872.523-2.734.523-.886 0-1.592-.286-2.203-.534l-.008-.003C7.662 1.21 7.139 1 6.5 1c-.669 0-1.606.229-2.415.478A21.294 21.294 0 0 0 3 1.845v6.433c.22-.078.48-.167.766-.255C4.576 7.77 5.638 7.5 6.5 7.5c.847 0 1.548.28 2.158.525l.028.01C9.32 8.29 9.86 8.5 10.5 8.5c.668 0 1.606-.229 2.415-.478A21.317 21.317 0 0 0 14 7.655V1.222z" />
                                </svg> 檢舉職缺
                            </button>
                            <div class="img-block">
                                <img src="https://upload.wikimedia.org/wikipedia/commons/9/9d/Yamaha_logo.svg" alt=""
                                    class="logo-img comPicture" name="comPicture">
                            </div>

                        </div>

                        <div class="jobTitle">
                            <h1 class="jobName" name="jobName">Java 後端工程師 </h1>
                            <a href="" class="company comName" name="comName">雅哈哈股份有限公司</a>
                        </div>

                        <div class="job-body">
                            <div class="job-content">
                                工作內容
                            </div>
                            <pre class="jobOther" name="jobOther">
1. 負責開發通訊軟體之後端 API 服務，以及整合既有 Open Source 軟體。 
2. 具備使用 Java Spring Boot 開發之經驗，能夠進行軟體之設計以及程式撰寫。 
3. 能與前端討論 API 之設計，具備良好溝通能力，重視團隊合作。 
4. 撰寫產品相關規格文件。
5. 能看懂 Python 程式，並瞭解其運作邏輯尤佳。 
6. 熟悉軟體和系統之安裝尤佳。 
7. 協助研發軟體新技術與新工具。
                            </pre>
                            <div class="details">
                                <p class="job-class"><strong>職務類別 : <span class="ptName"
                                            name="ptName">軟體工程師</span></strong></p>
                                <p class="job-payrange"><strong>薪資待遇 : <span class="jobSalary"
                                            name="jobSalary">45000</span>元<span
                                            style="color: orange;">（固定或變動薪資因個人資歷或績效而異）</span></strong></p>
                                <p class="job-location"><strong>上班地點 : <span class="comAddress"
                                            name="comAddress">桃園市中壢區復興路46號9樓</span></strong></p>

                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="map-container">
            <div class="lightbox-overlay"></div>
            <div class="lightbox-content">
                <iframe class="map-iframe" width="800" height="600" frameborder="0" scrolling="no" marginheight="0"
                    marginwidth="0"></iframe>
                <div class="close-button">Close</div>
            </div>
        </div>

    </main>


    <!--引入footer頁面-->
    <div id="footer"></div>

    <script>

        $(document).ready(function () {
            let projectName = window.location.pathname.split('/')[1]; // SeekerPool

            // 使用URLSearchParams对象获取URL参数
            let urlParams = new URLSearchParams(window.location.search);
            let jobNo = urlParams.get('jobNo');
            console.log('jobNo : ' + jobNo);
            let data = {
                jobNo: jobNo
            }

            $.ajax({
                url: '/' + projectName + "/JobResultShow",
                type: "GET",
                data: data,
                dataType: "json",
                success: function (data) {
                    generateDynamicContent(data);
                },
                error: function (xhr, status, error) {
                    console.log("Error: " + error);
                }
            });

            function generateDynamicContent(data) {
                $('.img-block').empty();
                $(".jobTitle").empty();
                $(".job-body").empty();

                let imgblock = $('.img-block');
                let jobTitle = $('.jobTitle');
                let jobBody = $(".job-body");

                $.each([data], function (index, item) {

                    var imgBlock = $("<div>", { class: "img-block" });
                    $("<img>", { src: item.comPicture, alt: "我是公司的LOGO啦", class: "logo-img comPicture", name: "comPicture" }).appendTo(imgBlock);
                    imgBlock.appendTo(imgblock);

                    $("<h1>", { class: "jobName", name: "jobName", text: data.jobName }).appendTo(jobTitle);
                    $("<a>", { href: "companyProfile.html?comMemId=" + item.comMemId, class: "company comName", name: "comName", text: data.comName }).appendTo(jobTitle);


                    // var jobBody = $("<div>", { class: "job-body" }).appendTo(container);
                    var jobContent = $("<div>", { class: "job-content", text: "工作要求" }).appendTo(jobBody);
                    $("<pre>", { class: "jobOther", name: "jobOther", text: data.jobOther }).appendTo(jobBody);

                    var details = $("<div>", { class: "details" }).appendTo(jobBody);
                    $("<p>", { class: "job-class" }).append($("<strong>").text("職務類別 : "))
                        .append($("<span>", { class: "ptName", name: "ptName", text: data.ptName })).appendTo(details);
                    $("<p>", { class: "job-payrange" }).append($("<strong>").text("薪資待遇 : "))
                        .append($("<span>", { class: "jobSalary", name: "jobSalary", text: data.jobSalary })).append("元")
                        .append($("<span>", { style: "color: orange;" }).text("（固定或變動薪資因個人資歷或績效而異）")).appendTo(details);
                    $("<p>", { class: "job-location" })
                        .append($("<strong>").text("上班地點 : "))
                        .append($("<span>", { class: "comAddress", name: "comAddress", text: data.jobAddress }))
                        .append($("<span>", { class: "icon", 'data-jobAddresss': data.jobAddress })
                            .append($("<img>", { src: "images/geo-alt.svg", alt: "Location", class: "icon-img", 'data-jobAddresss': data.jobAddress }))
                        )
                        .appendTo(details);
                });
            }
        });
    </script>

    <script>

        let projectName = window.location.pathname.split('/')[1]; //SeekerPool
        // 獲取當前頁面的URL参數
        var urlParams = new URLSearchParams(window.location.search);

        // 從URL参数得到jobNo和comMemId的值
        var jobNo = urlParams.get('jobNo');
        var comMemId = urlParams.get('comMemId');

        let data = {
            comMemId: comMemId,
            jobNo: jobNo
        }

        $('.resume').on('click', function () {

            $.ajax({
                url: '/' + projectName + "/JobApply",
                method: "POST",
                dataType: "json",
                success: function (data) {
                    if (data === "notlogin") {
                        location.href = "../member/memberlogin.html";
                        return; //中斷下面的sweetalert演出
                    }
                }, error: function (xhr, status, error) {
                    console.error(error);
                }
            })
        })

    </script>

    <script>

        $('.resume').on('click', function () {
            Swal.fire({
                title: '您確定嗎?',
                text: "此舉將會把您的履歷送出!",
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#3085d6',
                cancelButtonColor: '#d33',
                confirmButtonText: 'Yes'
            }).then((result) => {
                if (result.isConfirmed) {
                    $.ajax({
                        url: '/' + projectName + "/JobApply",
                        method: "POST",
                        data: data,
                        dataType: "json",
                        success: function (data) {
                            if (data === false) {
                                swal.fire(
                                    '已取消',
                                    '您已投過該職缺履歷',
                                    'info'
                                );
                            }
                        },
                        error: function (xhr, status, error) {
                            console.error(error);
                        }
                    });
                    Swal.fire(
                        'Success!',
                        '您的應徵履歷已送出',
                        'success'
                    );
                } else {
                    Swal.close(); // 關閉彈跳式視窗
                }
            });
            // 防止表單資料噴出
            event.preventDefault();
        });

    </script>

    <script>
        function executeExample() {

            // 獲取當前頁面的URL参數
            var urlParams = new URLSearchParams(window.location.search);

            // 從URL参数得到jobNo和comMemId的值
            var jobNo = urlParams.get('jobNo');

            let data = {
                jobNo: jobNo
            }

            $.ajax({
                url: '/' + projectName + "/JobCollect",
                method: "POST",
                data: data,
                dataType: "json",
                success: function (data) {
                    if (data === "notlogin") {
                        location.href = "../member/memberlogin.html";
                    }
                    if (data === false) {
                        console.log('data : ' + data);
                        console.log('判斷為false');

                        Swal.fire({
                            position: 'center',
                            icon: 'info',
                            title: '您已收藏該職缺至清單中 ! ',
                            showConfirmButton: false,
                            timer: 1500
                        })
                    } else if (data === true) {
                        Swal.fire({
                            position: 'center',
                            icon: 'success',
                            title: '已成功收藏至您的清單中 ! ',
                            showConfirmButton: false,
                            timer: 1500
                        })
                    }

                }, error: function (xhr, status, error) {
                    console.error(error);
                }
            })

            // Swal.fire({
            //     position: 'center',
            //     icon: 'success',
            //     title: '您已將此職缺收藏 ! ',
            //     showConfirmButton: false,
            //     timer: 1500
            // })
        }

    </script>

    <script>
        $('.report-button').on('click', function () {

            // 獲取當前頁面的URL参數
            var urlParams = new URLSearchParams(window.location.search);

            // 從URL参数得到jobNo和comMemId的值
            var jobNo = urlParams.get('jobNo');
            var comMemId = urlParams.get('comMemId');
            var newPageUrl = '/SeekerPool/front-end/member/report/Reportform.html' + '?comMemId=' + comMemId + "&jobNo=" + jobNo;

            $.ajax({
                url: '/' + projectName + "/CheckLogin",
                method: "GET",
                dataType: "json",
                success: function (data) {
                    if (data === "notlogin") {
                        location.href = "../member/memberlogin.html";
                    }
                }, error: function (xhr, status, error) {
                    console.error(error);
                }
            })
            window.location.href = newPageUrl;
        })

    </script>

    <script>

        $(document).on('click', '.icon', function () {
            var jobAddress = $(this).find('.icon-img').attr('data-jobaddresss');
            console.log("Google Map區塊 點擊測試，上班地點: " + jobAddress);

            var iframeSrc = "https://maps.google.com.tw/maps?f=q&hl=zh-TW&geocode=&q=" + jobAddress + "&z=16&output=embed&t=";

            // 更新燈箱中的 iframe 的 src 屬性
            $(".map-iframe").attr("src", iframeSrc);

            // 顯示燈箱
            $(".map-container").fadeIn();
        });

        $(document).on('click', '.close-button, .lightbox-overlay', function () {
            // 隐藏燈箱
            $(".map-container").fadeOut();
        });


    </script>





    <!-- bootstrap -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.1/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-/bQdsTh/da6pkI1MST/rWKFNjaCP5gBSY4sEBT38Q/9RBh9AH40zEOg7Hlq2THRZ"
        crossorigin="anonymous"></script>
    <!-- sweetalert -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

</body>

</html>